# 同步与异步

JavaScript是基于单线程运行的，也就是说一个时间只能运行一个任务，而其他的任务排列在当前任务之后等待执行。虽然JavaScript只能在单线程运行，但是JavaScript引擎却是多线程的，多出来的线程只是在后台配合主线程工作。

JavaScript内部采用的“事件循环”机制（Event Loop）。挂起处于等待中的任务，先运行排在后面的任务。等到IO操作返回了结果，再回过头，把挂起的任务继续执行下去。在html5中，我们被允许创建多个线程，但是子线程完全受主线程控制，而且不能操作dom。

## 同步和异步的区别

首先我们看一下同步和异步之间的区别：

**同步**就是在主线程执行的任务，他们只能按照顺序执行。

**异步**就是被分散在各个子线程的任务，他们不进入主线程，而进入任务队列的任务。只有在任务某些任务需要被执行的时候，才会被推入主线程。

## 任务队列和事件循环

浏览器引擎会每间隔一段时间就去检查一遍异步任务是否可以进入主线程。这种机制就叫**事件循环**。

**任务队列**就是保存将要执行的异步任务。

如果事件循环检查到**任务队列**里的异步任务满足进入主线程的条件，那么异步任务就重新进入主线程开始执行，这时它就变成同步任务了。等到执行完，下一个事件循环在检查是否有异步任务需要进入主线程开始执行，有的话加入主线程，一旦任务队列清空，程序就结束执行。

## 常用的异步操作

### 回调函数

回调函数可以说是异步操作最基本的方法。

```js
function fun1(callback) {
  // ...
  callback();
}

function fun2() {
  // ...
}

fun1(fun2);
```
这样fun2会等待fun1执行完毕后执行。

回调函数简单、容易理解和实现，但是在多个回调后不利于代码的阅读和维护，各个部分之间高度耦合，使得程序结构混乱、流程难以追踪。

### 事件模型

事件模型是最基础的异步编程形式。它会在你执行事件的时候向任务队列添加一个新任务来相应用户操作。

这种方法的优点是比较容易理解，可以用于简单的交互。可以绑定多个事件，每个事件可以指定多个回调函数。但是缺点整个程序都要变成事件驱动型，对用更加复杂的需求不是很灵活。

这里我们会先说这两个最简单，最常用的异步操作。现在已经有更好的方法去解决异步的操作问题，我们以后会涉及到。

## 总结

我们应该清楚JavaScript的运行机制和同步异步的概念。我们日后会经常使用异步操作。




